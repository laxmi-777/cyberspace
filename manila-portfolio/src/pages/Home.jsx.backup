import { useState, useEffect, useRef } from 'react';
import { useTheme } from '../context/ThemeContext.jsx';

const spaceItems = [
  { id: 1, type: 'project', title: 'Project Alpha', height: 'h-64', image: 'üöÄ', link: '/what-i-do' },
  { id: 2, type: 'game', title: 'Mini Game', height: 'h-80', image: 'üéÆ', action: 'game' },
  { id: 3, type: 'draw', title: 'Draw Space', height: 'h-72', image: '‚úèÔ∏è', action: 'draw' },
  { id: 4, type: 'project', title: 'Project Beta', height: 'h-96', image: 'üíª', link: '/what-i-do' },
  { id: 5, type: 'thought', title: 'Random Thought', height: 'h-64', image: 'üí≠', link: '/thoughts' },
  { id: 6, type: 'game', title: 'Puzzle Game', height: 'h-80', image: 'üß©', action: 'game' },
  { id: 7, type: 'project', title: 'Project Gamma', height: 'h-72', image: '‚ö°', link: '/what-i-do' },
  { id: 8, type: 'draw', title: 'Sketch Pad', height: 'h-64', image: 'üé®', action: 'draw' },
  { id: 9, type: 'about', title: 'About Me', height: 'h-80', image: 'üëã', link: '/who-i-am' },
  { id: 10, type: 'project', title: 'Project Delta', height: 'h-96', image: 'üåü', link: '/what-i-do' },
  { id: 11, type: 'game', title: 'Space Game', height: 'h-72', image: 'üåå', action: 'game' },
  { id: 12, type: 'thought', title: 'Deep Thoughts', height: 'h-64', image: 'ü§î', link: '/thoughts' },
];

export default function Home() {
  const [displayedText, setDisplayedText] = useState('');
  const fullText = "welcome to laxmi's cyberspace";
  const [isComplete, setIsComplete] = useState(false);
  const [isDisintegrating, setIsDisintegrating] = useState(false);
  const [disintegratedChars, setDisintegratedChars] = useState(new Set());
  const [showContent, setShowContent] = useState(false);
  const [isDrawingMode, setIsDrawingMode] = useState(false);
  const [isDrawing, setIsDrawing] = useState(false);
  const [isSwinging, setIsSwinging] = useState(false);
  const [scrollDepth, setScrollDepth] = useState(0);
  const { isDarkMode, setIsDarkMode } = useTheme();
  const canvasRef = useRef(null);
  const contextRef = useRef(null);
  const contentRef = useRef(null);

  useEffect(() => {
    if (displayedText.length < fullText.length) {
      const timeout = setTimeout(() => {
        setDisplayedText(fullText.slice(0, displayedText.length + 1));
      }, 50);
      return () => clearTimeout(timeout);
    } else {
      setIsComplete(true);
    }
  }, [displayedText]);

  useEffect(() => {
    const handleScroll = () => {
      if (contentRef.current) {
        const scrolled = contentRef.current.scrollTop;
        const maxScroll = contentRef.current.scrollHeight - contentRef.current.clientHeight;
        setScrollDepth((scrolled / maxScroll) * 100);
      }
    };

    const ref = contentRef.current;
    if (ref) {
      ref.addEventListener('scroll', handleScroll);
      return () => ref.removeEventListener('scroll', handleScroll);
    }
  }, [showContent]);

  useEffect(() => {
    if (isDrawingMode && canvasRef.current) {
      const canvas = canvasRef.current;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const context = canvas.getContext('2d');
      context.lineCap = 'round';
      context.strokeStyle = isDarkMode ? 'rgba(59, 130, 246, 0.8)' : 'rgba(37, 99, 235, 0.8)';
      context.lineWidth = 3;
      contextRef.current = context;
    }
  }, [isDrawingMode, isDarkMode]);

  const handleTextInteraction = () => {
    if (isComplete && !isDisintegrating) {
      setIsDisintegrating(true);
      
      const chars = fullText.split('').map((_, i) => i);
      const shuffled = chars.sort(() => Math.random() - 0.5);
      
      shuffled.forEach((charIndex, i) => {
        setTimeout(() => {
          setDisintegratedChars(prev => new Set([...prev, charIndex]));
        }, i * 20);
      });

      setTimeout(() => {
        setShowContent(true);
      }, shuffled.length * 20 + 800);
    }
  };

  const toggleLightMode = () => {
    setIsSwinging(true);
    setTimeout(() => {
      setIsDarkMode(!isDarkMode);
      setIsSwinging(false);
    }, 500);
  };

  const startDrawing = ({ nativeEvent }) => {
    if (!isDrawingMode) return;
    const { offsetX, offsetY } = nativeEvent;
    contextRef.current.beginPath();
    contextRef.current.moveTo(offsetX, offsetY);
    setIsDrawing(true);
  };

  const draw = ({ nativeEvent }) => {
    if (!isDrawing || !isDrawingMode) return;
    const { offsetX, offsetY } = nativeEvent;
    contextRef.current.lineTo(offsetX, offsetY);
    contextRef.current.stroke();
  };

  const stopDrawing = () => {
    if (!isDrawingMode) return;
    contextRef.current.closePath();
    setIsDrawing(false);
  };

  const getRandomTransform = () => {
    const angle = Math.random() * 360;
    const distance = 300 + Math.random() * 400;
    const x = Math.cos(angle * Math.PI / 180) * distance;
    const y = Math.sin(angle * Math.PI / 180) * distance;
    const rotation = Math.random() * 720 - 360;
    return { x, y, rotation };
  };

  const handleItemClick = (item) => {
    if (item.action === 'draw') {
      setIsDrawingMode(true);
      setShowContent(false);
    } else if (item.action === 'game') {
      alert('Mini game coming soon! üéÆ');
    }
  };

  const bgColor = isDarkMode ? '#191919' : '#f5f5f5';
  const textColor = isDarkMode ? 'text-white' : 'text-gray-900';
  const subtextColor = isDarkMode ? 'text-gray-400' : 'text-gray-600';
  const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';
  const cardBg = isDarkMode ? 'bg-[#1e1e1e]' : 'bg-white';
  const cardBorder = isDarkMode ? 'border-gray-800' : 'border-gray-200';
  const cardHover = isDarkMode ? 'hover:bg-[#252525]' : 'hover:bg-gray-50';

  return (
    <div 
      ref={contentRef}
      className="relative h-screen w-full overflow-y-auto overflow-x-hidden transition-colors duration-500 scroll-smooth"
      style={{ backgroundColor: bgColor }}
    >

  return (
    <div 
      className="relative h-screen w-full overflow-hidden transition-colors duration-500"
      style={{ backgroundColor: bgColor }}
    >
      {/* Lightbulb - Hanging from Top */}
      <div className="absolute top-0 right-8 z-50">
        <div className="relative">
          {/* Wire extending from top through viewport */}
          <div className="absolute left-1/2 -translate-x-1/2 w-0.5 bg-gray-500" 
               style={{ 
                 top: '-50vh',
                 height: 'calc(50vh + 60px)',
                 transformOrigin: 'top center' 
               }} />
          
          {/* Bulb Container */}
          <div 
            className={`relative cursor-pointer ${isSwinging ? 'animate-swing' : ''}`}
            onClick={toggleLightMode}
            style={{ 
              marginTop: '60px',
              transformOrigin: 'top center',
              animation: isSwinging ? 'swing 0.5s ease-in-out' : 'none'
            }}
          >
            {/* Lightbulb - Upside Down */}
            <svg 
              width="48" 
              height="64" 
              viewBox="0 0 48 64" 
              className="transition-all duration-300"
              style={{ transform: 'rotate(180deg)' }}
            >
              {/* Bulb glow effect when lit */}
              {isDarkMode && (
                <circle 
                  cx="24" 
                  cy="24" 
                  r="20" 
                  fill="url(#glow)" 
                  opacity="0.6"
                />
              )}
              
              {/* Main bulb shape */}
              <path
                d="M24 4 C14 4 8 10 8 20 C8 26 10 30 14 36 L14 44 L34 44 L34 36 C38 30 40 26 40 20 C40 10 34 4 24 4 Z"
                fill={isDarkMode ? '#FCD34D' : '#D1D5DB'}
                stroke={isDarkMode ? '#F59E0B' : '#9CA3AF'}
                strokeWidth="1"
                className="transition-colors duration-300"
              />
              
              {/* Base */}
              <rect
                x="14"
                y="44"
                width="20"
                height="8"
                fill={isDarkMode ? '#9CA3AF' : '#6B7280'}
                className="transition-colors duration-300"
              />
              
              {/* Base lines */}
              <line x1="14" y1="47" x2="34" y2="47" stroke={isDarkMode ? '#6B7280' : '#4B5563'} strokeWidth="1" />
              <line x1="14" y1="49" x2="34" y2="49" stroke={isDarkMode ? '#6B7280' : '#4B5563'} strokeWidth="1" />
              
              {/* Filament (only visible when on) */}
              {isDarkMode && (
                <path
                  d="M20 18 L22 24 L26 24 L28 18"
                  stroke="#F59E0B"
                  strokeWidth="1.5"
                  fill="none"
                  opacity="0.8"
                />
              )}
              
              {/* Shine effect */}
              <ellipse
                cx="20"
                cy="16"
                rx="4"
                ry="6"
                fill="white"
                opacity={isDarkMode ? "0.3" : "0.2"}
              />
      {/* Grid Background */}
      <div 
        className="fixed inset-0 opacity-30 transition-opacity duration-500 pointer-events-none"
        style={{
          backgroundImage: `
            linear-gradient(${gridColor} 1px, transparent 1px),
            linear-gradient(90deg, ${gridColor} 1px, transparent 1px)
          `,
          backgroundSize: '40px 40px'
        }}
      />

      {/* Depth Indicator - Space Diving Animation */}
      {showContent && !isDrawingMode && (
        <div className="fixed left-4 top-1/2 -translate-y-1/2 z-40">
          <div className="flex flex-col items-center gap-2">
            <div className={`text-xs ${subtextColor} writing-mode-vertical transform rotate-180 mb-4`}>
              depth: {Math.round(scrollDepth)}%
            </div>
            <div className={`w-1 h-64 ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'} rounded-full relative overflow-hidden`}>
      
      {/* Drawing Canvas */}
      {isDrawingMode && (
        <div className="fixed inset-0 z-50">
          <button
            onClick={() => {
              setIsDrawingMode(false);
              setShowContent(true);
              const ctx = contextRef.current;
              if (ctx) {
                ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
              }
            }}
            className={`absolute top-4 right-4 px-4 py-2 rounded ${cardBg} ${cardBorder} border ${textColor} ${cardHover} transition-colors z-50`}
          >
            ‚Üê Back
          </button>
          <canvas
            ref={canvasRef}
            className="absolute inset-0"
            style={{ cursor: 'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMyAyMUwxOSA1TDE5IDEwTDcgMjJMMy4yNSAyMC43NUwyIDIxWiIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=") 0 24, auto' }}
            onMouseDown={startDrawing}
            onMouseMove={draw}
            onMouseUp={stopDrawing}
            onMouseLeave={stopDrawing}
          />
        </div>
      )}
      
      {/* Hero Section - Initial Animation */}
      {!showContent && !isDrawingMode && (
        <div className="relative h-screen flex items-center justify-center">
          <div className="text-center space-y-6 px-4">
            <h1 
              className={`text-5xl md:text-7xl font-bold ${textColor} min-h-[1.2em] cursor-pointer select-none transition-colors duration-500`}
              onClick={handleTextInteraction}
            >
              {displayedText.split('').map((char, i) => {
                const transform = getRandomTransform();
                return (
                  <span
                    key={i}
                    className={`inline-block transition-all duration-1000 ${
                      disintegratedChars.has(i) ? 'pointer-events-none' : ''
                    }`}
                    style={{
                      transform: disintegratedChars.has(i)
                        ? `translate(${transform.x}px, ${transform.y}px) rotate(${transform.rotation}deg) scale(0)`
                        : 'translate(0, 0) rotate(0deg) scale(1)',
                      opacity: disintegratedChars.has(i) ? 0 : 1,
                      filter: disintegratedChars.has(i) ? 'blur(8px)' : 'blur(0)',
                      transition: 'all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)',
                    }}
      
      {/* Subtle gradient overlay */}
      <div className={`fixed inset-0 bg-gradient-to-b from-transparent via-transparent ${isDarkMode ? 'to-[#191919]/50' : 'to-[#f5f5f5]/50'} pointer-events-none transition-colors duration-500`} />
      
      <style>{`
        @keyframes swing {
          0%, 100% { transform: rotate(0deg); }
          25% { transform: rotate(15deg); }
          75% { transform: rotate(-15deg); }
        }
        
        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .animate-fade-in {
          animation: fade-in 0.6s ease-out forwards;
        }
      `}</style>
    </div>
  );
}
      {/* Pinterest-style Masonry Grid - Space Content */}
      {showContent && !isDrawingMode && (
        <div className="relative min-h-screen pb-20">
          {/* Scroll hint */}
          <div className="h-screen flex items-center justify-center sticky top-0">
            <div className="text-center space-y-4 animate-fade-in">
              <p className={`${textColor} text-2xl md:text-4xl font-bold`}>
                descending into cyberspace...
              </p>
              <p className={`${subtextColor} text-sm md:text-base`}>
                scroll to explore ‚Üì
              </p>
            </div>
          </div>

          {/* Masonry Grid */}
          <div className="relative px-4 md:px-8 max-w-7xl mx-auto">
            <div className="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4">
              {spaceItems.map((item, index) => (
                <div
                  key={item.id}
                  className={`break-inside-avoid mb-4 ${item.height} ${cardBg} ${cardBorder} border rounded-lg overflow-hidden ${cardHover} transition-all duration-300 cursor-pointer group animate-fade-in`}
                  style={{ animationDelay: `${index * 100}ms` }}
                  onClick={() => item.link ? window.location.href = item.link : handleItemClick(item)}
                >
                  <div className="h-full flex flex-col items-center justify-center p-6 relative">
                    <div className="text-6xl md:text-7xl mb-4 group-hover:scale-110 transition-transform duration-300">
                      {item.image}
                    </div>
                    <h3 className={`${textColor} text-xl md:text-2xl font-semibold text-center`}>
                      {item.title}
                    </h3>
                    <span className={`${subtextColor} text-xs uppercase tracking-wider mt-2`}>
                      {item.type}
                    </span>
                    
                    {/* Hover overlay */}
                    <div className="absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-colors duration-300" />
                  </div>
                </div>
              ))}
            </div>

            {/* End marker */}
            <div className="text-center py-16">
              <p className={`${subtextColor} text-lg`}>
                you've reached the depths of cyberspace üåå
              </p>
            </div>
          </div>
        </div>
      )}        <span
                      key={i}
                      className={`inline-block transition-all duration-1000 ${
                        disintegratedChars.has(i) ? 'pointer-events-none' : ''
                      }`}
                      style={{
                        transform: disintegratedChars.has(i)
                          ? `translate(${transform.x}px, ${transform.y}px) rotate(${transform.rotation}deg) scale(0)`
                          : 'translate(0, 0) rotate(0deg) scale(1)',
                        opacity: disintegratedChars.has(i) ? 0 : 1,
                        filter: disintegratedChars.has(i) ? 'blur(8px)' : 'blur(0)',
                        transition: 'all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)',
                      }}
                    >
                      {char === ' ' ? '\u00A0' : char}
                    </span>
                  );
                })}
                {!isComplete && !isDisintegrating && <span className="animate-pulse">|</span>}
              </h1>
              <p className={`${subtextColor} text-lg md:text-xl max-w-2xl mx-auto transition-opacity duration-500 ${isComplete && !isDisintegrating ? 'opacity-100' : 'opacity-0'}`}>
                explore the tabs on the left to learn more about me
              </p>
            </>
          )}
        </div>
      </div>
      
      {/* Subtle gradient overlay */}
      <div className={`absolute inset-0 bg-gradient-to-b from-transparent via-transparent ${isDarkMode ? 'to-[#191919]/50' : 'to-[#f5f5f5]/50'} pointer-events-none transition-colors duration-500`} />
      
      <style>{`
        @keyframes swing {
          0%, 100% { transform: rotate(0deg); }
          25% { transform: rotate(15deg); }
          75% { transform: rotate(-15deg); }
        }
      `}</style>
    </div>
  );
}
